# Mosaic WordPress Theme

Полнофункциональная WordPress-тема с модульной архитектурой, кастомным каталогом, админ-панелью для управления контентом и адаптивным дизайном.

## Особенности

- ✅ **Модульная структура**: `functions.php` — bootstrap, логика вынесена в `inc/`
- ✅ **Каталог**: CPT `catalog_item` + таксономия `catalog_category` с term meta (изображение, видео, интерьер)
- ✅ **Админка**: управление новостями, процессом работы, настройками сайта
- ✅ **Контактная форма**: сохранение в БД + отправка в Telegram
- ✅ **Видео из медиатеки**: для разделов каталога с лимитом 8MB
- ✅ **Адаптивный дизайн**: breakpoints, Swiper.js, custom UI

## Структура

```
inc/
├── helpers.php          # Вспомогательные функции
├── enqueue.php          # Подключение стилей/скриптов
├── settings.php         # Настройки сайта (контакты, соцсети, адрес, график)
├── contact-handler.php  # Обработка контактной формы (БД + Telegram)
├── breakpoints.php      # Брейкпоинты для CSS/JS
├── catalog/
│   ├── post-types.php   # Регистрация CPT/таксономий каталога
│   ├── term-meta.php    # Term meta для категорий (изображение, видео, интерьер)
│   └── item-meta.php    # Post meta для товаров (галерея, материал, техника, похожие)
└── admin/
    ├── news.php         # Админка новостей (таблица → карточка)
    └── process.php      # Админка процесса работы (таблица → карточка + drag&drop)
```

## Установка на продакшн

### 1. Клонирование репозитория

На сервере перейди в `wp-content/themes/` и клонируй репозиторий:

```bash
cd /path/to/wordpress/wp-content/themes/
git clone <url-этого-репозитория> mosaic
```

### 2. Активация темы

В админке WordPress: **Внешний вид → Темы → Mosaic → Активировать**

### 3. Настройка сервера

Убедись, что серверные лимиты позволяют загружать видео до 8MB:

**php.ini** (или php-fpm pool):
```ini
upload_max_filesize = 8M
post_max_size = 12M
memory_limit = 256M
```

**Nginx**:
```nginx
client_max_body_size 12m;
```

После изменений перезапусти PHP/веб-сервер.

### 4. Настройка Telegram бота (для контактной формы)

#### 4.1. Создание бота

1. Открой Telegram и найди **@BotFather**
2. Отправь команду `/newbot`
3. Введи имя бота (например, "Si Mosaic Forms")
4. Введи username бота (например, `simosaic_forms_bot`)
5. **Скопируй Bot Token** вида: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

#### 4.2. Получение Chat ID

**Для личных сообщений:**
1. Найди своего бота в Telegram по username
2. Отправь боту `/start`
3. Открой в браузере: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Найди в JSON `"chat":{"id":123456789}` — это твой Chat ID

**Для группового чата:**
1. Создай группу в Telegram
2. Добавь бота в группу (сделай администратором)
3. Отправь любое сообщение в группу
4. Открой в браузере: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
5. Найди `"chat":{"id":-100123456789}` — Chat ID группы (с минусом!)

#### 4.3. Добавление констант в wp-config.php

В файл `wp-config.php` **перед строкой** `/* That's all, stop editing! */` добавь:

```php
// Telegram Bot для контактной формы
define('MOSAIC_TELEGRAM_BOT_TOKEN', '1234567890:ABCdefGHIjklMNOpqrsTUVwxyz');
define('MOSAIC_TELEGRAM_CHAT_ID', '-100123456789'); // или обычный ID
```

**Важно:** Замени значения на свои реальные токен и Chat ID!

### 5. Первичная настройка контента

После активации темы:

1. **Постоянные ссылки**: Настройки → Постоянные ссылки → Сохранить (flush rewrite rules)
2. **Разделы каталога**: Каталог → Разделы каталога → добавить термины + выбрать изображения/видео
3. **Товары**: Каталог → Все товары → создать посты
4. **Новости**: Новости → добавить
5. **Процесс работы**: Процесс работы → добавить блоки
6. **Настройки**: Настройки → заполнить контакты/адрес/график
7. **Заявки**: После настройки Telegram заявки будут приходить в бот и сохраняться в админке (Заявки)

### 6. Миграция (если переносишь с локалки)

Если на проде **другая база** — нужно заново создать контент через админку.

Если **та же база** (или синхронизируется):
- Legacy video URL (`mosaic_cat_video_url`) будут автоматически удалены при первом заходе в админку.
- Нужно заново выбрать видео для разделов каталога через медиатеку.

## Обновление на проде

```bash
cd /path/to/wordpress/wp-content/themes/mosaic/
git pull origin main
```

После `git pull` зайди в админку — миграции (если есть) запустятся автоматически.

## Разработка

### Локальный запуск

Тема уже в локальном WordPress, просто активируй её.

### Коммиты

```bash
cd wp-content/themes/mosaic/
git add .
git commit -m "feat: описание изменений"
git push origin main
```

### Правила кодстайла

См. `.cursor/rules/mosaic.mdc` в корне проекта или `README.mosaic.md` в теме.

## Поддержка

- **WordPress**: 6.0+
- **PHP**: 7.4+
- **Плагины**: не требуются (тема автономна)

## Лицензия

Proprietary

